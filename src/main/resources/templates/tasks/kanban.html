<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="content" class="p-4">
  <div class="flex justify-between items-center mb-8">
    <h2 class="text-2xl font-bold">Bảng công việc</h2>
    <button onclick="openModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold">
      + Thêm nhiệm vụ
    </button>
  </div>

  <div class="flex gap-6 overflow-x-auto pb-6">
    <div class="w-80 flex-shrink-0" th:each="status : ${statuses}">
      <h3 class="font-bold text-slate-500 mb-4 uppercase text-xs" th:text="${status}"></h3>

      <div class="space-y-4 min-h-[500px]">
        <th:block th:each="task : ${tasks}">
          <div th:if="${task.status == status}" class="bg-white p-4 rounded-2xl shadow-sm border group relative">

            <form th:action="@{/tasks/delete/{id}(id=${task.id})}" method="post"
                  class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
              <button type="submit" onclick="return confirm('Bạn có chắc muốn xóa?')" class="text-red-400 hover:text-red-600">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </form>

            <h4 class="font-bold text-sm mb-2" th:text="${task.title}"></h4>
            <p class="text-xs text-slate-400 mb-4" th:text="${task.description}"></p>

            <div class="text-[10px] text-slate-300 font-bold" th:text="${task.dueDate}"></div>
          </div>
        </th:block>
      </div>
    </div>
  </div>

  <div id="createModal" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-md rounded-[32px] shadow-2xl p-8">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold">Nhiệm vụ mới</h3>
        <button onclick="closeModal()" class="text-slate-400"><i data-lucide="x"></i></button>
      </div>

      <form th:action="@{/tasks/create}" method="post">
        <input type="hidden" name="projectId" value="1"> <div class="space-y-4">
        <input type="text" name="title" placeholder="Tiêu đề..." required class="w-full p-3 bg-slate-50 rounded-xl border-none">
        <textarea name="description" placeholder="Mô tả..." class="w-full p-3 bg-slate-50 rounded-xl border-none h-24"></textarea>
        <div class="grid grid-cols-2 gap-4">
          <input type="date" name="dueDate" class="w-full p-3 bg-slate-50 rounded-xl border-none">
          <input type="datetime-local" name="reminderTime" class="w-full p-3 bg-slate-50 rounded-xl border-none">
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold">Xác nhận tạo</button>
      </div>
      </form>
    </div>
  </div>

  <script>
    function openModal() { document.getElementById('createModal').classList.remove('hidden'); }
    function closeModal() { document.getElementById('createModal').classList.add('hidden'); }
    lucide.createIcons();
  </script>
</div>
</body>
</html>